ch
Zone的不规范划分导致controller无法正常切换
 客户环境是典型的拓扑结构，因为controllerA出了问题，需要更换。 【Problem】 虽然在更换的过程中controllerB正常的接管了controllerA的LUN，但是在更换结束之后，controllerA的LUN始终无法切回到A控上。 【Action】 fget_config -Av可以看到dac1和dac3都是active的，理应能够正常切换的。不过从数字上看觉得有点不妥，一般来说只连接一个DS4000的时候认到的controller应该是dac0和dac1。 于是又敲了命令lsdev -C|grep dac，结果发现主机上有认到4个dac（dac0-dac3）。 我们都知道对于连接DS4000的Zone划分有几个原则，出现客户这种情况肯定是违反了每一个HBA只能看到一个controller的划分原则导致的。 在检查了SAN Switch的Zone配置之后果然证明了我的想法，BP在实施的时候把主机的HBA与两个controller组到了一个Zone里面，导致了主机一共认到4个dac，结果在做切换的时候主机端无法判断切换的dac导致切换失败。 这种错误是很可怕的，试想如果在生产阶段一个controller坏掉了，却无法正常切换到另一个控制器，很可能就造成了一次CIE。 还好这次更换操作，我是让客户停掉了应用做的，否则我就中彩了。 最后，我将客户的vg全部export，将主机识别到的dar，dac，hdisk全部删掉，更改SAN Switch的Zone配置，再在主机端重新识别，importvg，最后再次切换controller才得以解决。 【Summary】 对于midrange storage通过SAN Switch连接时，对于Zone的配置有以下几个原则一定要牢记： &middot; Every adapter in the AIX system can see only one controller (these are AIX specific zoning restrictions, not HACMP specific). &middot; Other storage devices, such as tape devices or other disk storage, must be connected through separate HBAs and SAN zones. (AIX specific) &middot; Multiple HBA&rsquo;s in the same server cannot &ldquo;see&rdquo; the same DS4000 controller port. (each in their separate zone) &middot; The HBA&rsquo;s are isolated from each other (ZONED) if they are connected to the same switch that is connected to the same DS4000 controller port. &middot; Each HBA and controller port must be in its own fabric zone, if they are connecting through a single switch. 在客户那边做一些危险性较高的操作之前最好能与客户协商申请到一个停机时间，实在不能停机的在操作之前一定要检查仔细，尽量排除一些隐患，因为很多客户环境都是由BP搭建的，这些BP参差不齐很有可能在搭建之初就给系统埋下了隐患，我们在维护的过程中很有可能踩雷，到时倒霉的就是我们了。发现了隐患，并告知客户，无形之中也提高了我们IBM的专业形象，提高了客户满意度：） PS 1. 关于DS8000的mapping和zoning，在logical config里面有说明： 注意：一般来说在san上面，主机端过来的口称为initiator口，存储端过来的口称为target口。 不管是连4000，5000还是8000，在一个zone里面只能有一个initiator口，对于target口无限制。 2. wwn(world wide name)分为wwnn(world wide node name)和wwpn(world wide port name) 一般我们做划WWN zone的时候，用的都是world wide port name 3. 如果用的是sdd驱动，在删除对应光纤卡之后，只会删除系统中的hdisk，然后删除dpo，会删除系统中的vpath。 如果用的是sddpcm驱动，只有在删除pcmpath query adapter看到的最后一块光纤卡后，hdisk才会被删除。 