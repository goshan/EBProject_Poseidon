ch
system Z9 微码升级总结 from CCB DCC SH
 CCB Z9 微码升级总结 一、 微码升级策略 1、 升级目标 花木生产CF机器（2094）从DRV67BDL36到DRV67BDL52 2、 升级流程 把DRV67BDL36到DRV67BDL52的升级分三步完成，分三步走是为了使每次升级的微码跨度较小，之前有客户遇到微码升级跨度太大而没有升级成功的案例（去年花木z10升级也是分两步完成的）。 1）.先升级CFCC这一个stream ( G40953 )，剩下的微码在2，3步完成 2）.从DRV67BDL36升级到DRV67BDL42b 3）.从DRV67BDL43升级到DRV67BDL52 Tips:之所以先选择升级CFCC这一个stream ( G40953 )的原因见下面ICBC微码升级的经验总结。（这个问题仅会出现在CF的LAPR上，如果不是CF的Z9升级微码，可以按照正常流程来做） 二、 微码下载 我们可以去以下的FTP地址去下载主机的微码 9.181.68.168 port: 22 用户名：EC 密码：12345678 这个服务器上有driver 3G~76的各版本微码，这次升级我们下载的是driver 67 MCL的微码包。 三、 微码刻盘 最好的方式是用HMC上的Console Action- Format media- Format DVD- Change management system update level来制作一张微码升级的DVD。 但是经过试验，我发现我们的笔记本上的DVD刻录机大多没有追加刻录DVD的功能，所以只好按照HMC制作的DVD的格式来手动制作微码的光盘，具体格式如下： 卷标：ACTSUL 文件夹： \lost+found \mcl 我们下载的微码就放在mcl文件夹下。请注意下载的微码为打包格式，需要解压缩。并且解压缩的格式并不统一，有的还套有文件夹，需要把所有的微码文件复制到同一个文件夹下，刻录到光盘的MCL文件夹中。 Ge san的评论： 我们下载的微码就放在mcl文件夹下。 有些版本的HMC是从光盘的根目录去找MCL的，所以刻盘的时候不妨把下载的微码同时刻到根目录及MCL目录下。 四、 升级准备 1、 Backup critical data 2、 Mirror和switch主备SE，需要20分钟到半小时左右。 3、 2094微码升级新备件现场standby准备 备件号 备件描述 15R8256 Z9 SE 12R7401 BPD 41U0125 BPI 12R8143 BPR 12R7710 DCA-TSP( CEC cage) 44P2550 DCA-CXT( IO cage) 4、 开启service mode。 5、 用准备好的DVD把微码retrieve到SE中。 1） 也可以用U盘在HMC上retrieve，就是直接把微码直接拷贝到U盘，然后retrieve的时候选择从U盘里面导微码。 2） 在HMC上 retrieve code到对应的机器的时候，可以选择选中所有的CPC然后change management然后retrie Internal code，不合适的CPC会自动不装。比如我们花木的Z10就不会导入Z9的code，这个对一次导入多台机器比较好（如果分批不同时间升级就不需要这样做）。 五、 升级过程 1、 升级CFCC这一个stream ( G40953 ) 1） 升级之前先检查主SE和all CFCC Images之间的通信是否正常 方法是： - Logon SE - Select one CFCC Image, double click &#39;Operation Message&#39; - Input &#39;D MODE&#39; or &#39;HELP&#39; If no response, reboot SE and check it again. If still no response, STOP 见下图 在我们对两台CF机器做此操作的时候发现有一台机器输入&#39;D MODE&#39;或 &#39;HELP&#39;的时候完全没反应（此时也没任何报错）。后来经过尝试选择对应的Message然后按Delete按钮把Operation Message逐条删除，然后再输入这两个命令，就正常了。 2、 从DRV67BDL36升级到DRV67BDL42b 3、 从DRV67BDL43升级到DRV67BDL52 4、 升级过程 1）Accept installed changes，如果之前没有做过升级的话，这个选项就会是灰的，跳过此步。 如果是分步升级的话，建议每次不要做，因为做了之后就无法回退了，建议等到下次微码升级的时候再做（此时上次微码已经运行过一段时间，应该没什么问题了），以便如果发生问题，可以及时回退。 2） Check dependencies，如果提示所有的微码都meet，就可以开始正式升级了。在我们这次升级中，会提示由于微码之间的制约关系，可能此次升级需要分几次进行。 3） Browse system and internal code information，可以看到的确有部分微码提示需要disruptive升级，还有部分微码concurrent只能升到一个中间的level，需要到最终的版本也需要disruptive操作。其实经过实际操作，这些微码最后都能被完整的完成升级。 4）Install and active changes，会出现对话框提示是concurrent only的方式还是允许disruptive的方式升级，我们选择concurrent only的方式。升级过程为1小时整，大约半小时升级微码，半小时重启SE并active 六、 完成升级 在SE重启完成后登入SE，会有对话框提示升级已完成。 Browse system and internal code information后检查active的微码是否和retrieve的微码一致，本次升级的结果应该如下所示 检查完成后，mirror到alternate SE并且backup critical data，升级完成。 