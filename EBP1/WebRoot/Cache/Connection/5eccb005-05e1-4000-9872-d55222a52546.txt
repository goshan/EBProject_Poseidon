ch
SVC维修有感
 前几天在客户处着实折腾了一把SVC，发现SVC其实没有我们想象中的那么神秘，了解了SVC的工作原理，再知道几个简单的三板斧，就能搞定大多数情况。 记住一点：SVC的很多功能不是能在前面板找到的，因为很多功能的实现是依靠很牛X的&mdash;&mdash;组合键~~！！！ 一板斧：看前面板的报错 SVC前面板在SVC发生故障时，都会有报错，一般无外乎Cluster error:XXX ;Node error:XXX这样的问题。只要对应code在trouble shooting guide找到相应的code，后面都会有故障描述，以及处理的action建议。 二板斧：SVC多节点冗余，更换硬盘要小心 SVC设计的是必须有偶数个节点作为cluster，至少有两个节点，在SVC的负载均衡的前提下，保证了冗余度，所以一般情况而言，都是只有一个SVC节电出问题，这个比较好处理，只要SVC能够正常运转，单独处理这个故障节点即可。如果SVC宕掉了，而且启动的时候两个节点都报错，且cluster ip无法连接，基本可以断定两个节点或多或少都有问题了。这个时候如果对SVC进行维护操作，特别是对service card和硬盘进行维护操作的时候一定要小心，尽量保存原service card和硬盘不要动，使用新备件进行测试，最大限度保存原配置数据。 三板斧：SVC终极修复利器：T3 RECOVERY 先行说明，T3 recovery是PE control的，一定要在PE的指导和confirm下进行，这里给大家公布出来秘籍，是以备特殊情况下我们自己能够自由发挥，风险自担哦。 SVC的重要数据，就是磁盘在SVC上进行各种切块再分配后的vdisk的配置信息，是数据能够访问的基础（image模式除外），所以SVC的config至关重要。SVC的config会在每个节点都保存一份，所以只要SVC里有一个节点是OK的，都可以通过这个节点去恢复SVC。另外SVC的config还会在SVC config node上保存一份，而时间戳记录在quorum磁盘上，这个就是在SVC每个node都挂掉的情况下恢复SVC的法宝了。 换句话说，T3 recovery就是把quorum磁盘上的timestamp读取出来，结合config node的备份数据进行恢复的过程，当然了，前提条件是：1.config node的磁盘没挂；2.SVC有quorum磁盘，且timestamp合适。 最后总结一下我目前知道的SVC的组合键，顺便说明下T3 recovery的步骤： 1.进service mode：在前面板选到recovery cluster,按确定，显示service access? ，按住下键不松，按一下确定键，再松开下键。 2.重置superuser口令：在前面板选到recovery cluster,按确定，显示service access? ，按住上键不松，按一下确定键，再松开上键。 3.更换硬盘后从SVC中其他节点恢复硬盘上的软件（不包含配置）:关闭节点，电源灯慢闪的时候按住左键和右键不松，按一下电源键，等面板显示 的时候再松开左键和右键。 4.在前面板删除一个node的cluster信息：在前面板选到create cluster，按确定，显示delete cluster，按住上键不松，按一下确定键，再松开上键。 5.进入T3 recovery模式： A.需要恢复的节点先进入service mode，将和其他SVC通信的网卡的IP地址（就是service ip）配置成和cluster ip相同网段的IP（这个如果以前有cluster的话，一般自动都是OK的），然后回到面板显示service mode的状态。 B.其他节点如果有cluster信息，则通过前面板删除cluster信息，使得前面板显示cluster：状态。 C.在需要恢复的节点上按住左键和右键不松，按两下确定键，再松开左键和右键，屏幕显示retrieving，scan qdisk0、1、2，然后显示T3 DATA，有一个时间。 D.确认该时间是可以接受的timestamp恢复时间，按住上键不松，按一下确定键，再松开上键继续。否则按住下键不松，按一下确定键，再松开下键退出。 E.屏幕显示backup file：，有一个时间，确认该时间是可以接受的配置备份恢复时间，按住上键不松，按一下确定键，再松开上键继续。否则按住下键不松，按一下确定键，再松开下键退出。 F.然后显示rebuild cluster，等待直到显示T3 SUCCESSFUL，T3 RECOVERY完成，此时几个节点应该都已经恢复cluster配置信息并加入cluster了。 