ch
浅谈alt_disk_install 命令
 对于alt_disk_install 命令大家并不陌生，在某数据中心工作的时候，绝大多数的系统都是通过alt_disk_install 方式进行的克隆，但是在整个做的过程中还是碰到了不少问题。根据实际情况来看其主要原因还是因为命令使用不当导致的。之前看到一个帖子讲由于使用clone命令进行了系统克隆，结果导致dlpar无法正常使用，根本原因还是对alt_disk_install命令的了解不透彻。 我个人觉得alt_disk_install 这个命令使用的第一个场景是，如果需要在某重要系统上进行测试，为了不破坏原有系统的完整性，那么就用标准命令：alt_disk_install hdiskx 即可，这样执行后会修改bootlist，会将系统原封不动的克隆至目标硬盘，我们直接重启就能进入克隆系统并做自己想做的测试。 alt_disk_install 使用场景二：用于系统的快熟安装，根据规范安装一个系统是一个复杂的流程，因为需要装bundle，需要配置用户，需要做系统参数设置，通常xx数据中心的要求繁多，那么通过clone可以快熟进行系统部署，但是在选择命令参数需要正确。 alt_disk_install -BOC hdiskx，为什么选用这样的参数，我将参数给大家，大家仔细研究吧。 标志 -B 将指定在mksysb 或克隆后不运行引导列表。如果设置它，那么-r标志就不能使用。 -C 克隆rootvg。 注：-d和-C是互斥的。 -ddevice device的值可能是： 磁带机－例如，/dev/rmt0 或 文件系统中的mksysb 映象的路径名称。 注：-d和-C是互斥的。 -D 打开调试（设置-x输出）。 -iimage.data 使用可选的image.data 文件，而不用来自mksysb 映象的缺省image.data 或从rootvg 创建的image.data。image.date 文件名称必须是一个完整的路径名，例如/tmp/my_image.data。 对于alt_disk_install4.3.2 或更高版本： 如果某逻辑卷需要置于特定的目标磁盘上，这应在用户指定的image.data 文件的逻辑卷LV_SOURCE_DISK_LIST 字段中做注释。 -pplatform 这是用来创建磁盘引导映象名称的平台，它可能由想要支持此功能的供应商提供。此标志仅对mksysb 安装有效（-d标志）。 -Pphase 在alt_disk_install这个调用过程中要执行的阶段。有效值是：1、2、3、12、23 或all。 12 －执行阶段1 和2。 23 －执行阶段2 和3。 all －执行所有三个阶段 -r 将指定当alt_disk_install命令完成时，从新磁盘重新引导。 -Rresolv_conf 在已经恢复了mksysb 或克隆了rootvg 之后，resolv.conf文件用来替代现有的文件。必须使用resolv_conf的完整路径名。 -sscript 在mksysb 安装或rootvg 克隆运行结束时要运行的可选的定制脚本。此文件必须是可执行的。/alt_inst 文件系统卸装之前在正运行的系统上调用此脚本，这样，文件可在重新引导前从正运行的系统复制到/alt_inst文件系统。这是在备用文件系统中复制或修改文件的唯一机会，因为逻辑卷名称将更改以与rootvg 的逻辑卷名称匹配，而且在用新的备用rootvg 重新引导系统或在altinst_rootvg 上执行&ldquo;唤醒&rdquo;之后才能访问它们。必须使用script的完整路径名。 -V 打开详细的输出。这将显示正为rootvg 克隆而备份的文件。此标志显示为mksysb alt_disk_installs 而恢复的文件。 -Lmksysb_level 此级别将与平台类型组合在一起以创建要使用的引导映象名称（例如，AIX 5.1 及较早版本中的rspc_4.3.0_boot）。这必须是V.R.M. 格式。缺省值将是AIX 4.3。将相对该级别检查mksysb 映象以验证它们是相同的。 -n 保留NIM 客户机。/.rhosts和/etc/niminfo文件复制到备用rootvg 的文件系统。 -X 从ODM 数据库中除去altinst_rootvg 卷组定义。这将返回卷组的lspv列表的值&ldquo;None&rdquo;。这不会从卷组中除去实际数据。所以，如果重新设置引导列表，您依旧可以从该卷组重新引导。 对于alt_disk_install4.3.2 或更高版本，此标志允许指定的卷组名称ODM 数据库定义的删除，例如-X old_rootvg。 -O 在目标altinst_rootvg 上执行设备的复位。这将使alt_disk_install不保留任何用户定义的设备配置。如果一个或多个目标磁盘将成为不同系统的rootvg（比如在逻辑分区或系统磁盘交换的情况下），此标志是非常有用的。 以下标志仅当克隆rootvg 时使用才有效（-C）。 -bbundle_name 具有将在rootvg 克隆后安装的软件包或文件集列表的可选文件的路径名。-l标志必须和该选项一起使用。 -eexclude_list 当克隆rootvg 时使用的可选的exclude.list。排除的规则遵循grep命令的模式匹配规则。exclude_list必须是一个完整的路径名。 注：如果要从备份中排除某些文件，请用ASCII 编辑器创建/etc/exclude.rootvg文件，并输入您不想包括在系统备份映象中的文件名称的模式。此文件中的模式是grep命令模式匹配约定的输入内容，此输入内容用来确定要从备份中排除哪些文件。如果要排除在/etc/exclude.rootvg文件中列出的文件，请选择&ldquo;排除文件&rdquo;字段或按跳格一次来将缺省值更改至&ldquo;yes&rdquo;。 例如，要排除名为scratch 目录中的所有内容，请编辑exclude 文件使其读起来如下所示： /scratch/ 例如，要排除名为/tmp目录中的内容，并避免其它任何路径名中具有/tmp的目录，请编辑exclude 文件使其读起来如下所示： ^./tmp/ 所有的文件都相对于（当前工作目录）备份。要排除任何对于在行首使搜索匹配字符串非常重要的文件或目录，请在搜索字符串的第一个字符使用^ (插入记号)，后面紧跟.（点字符），再紧跟要排除的文件名或目录。 如果要排除的文件名或目录是另一个文件名或目录的子串，请使用^.（插入记号后紧跟点字符）来指定搜索应在行首开始和／或使用$（美元符号）来指明搜索应在行末结束。 -ffix_bundle 克隆rootvg 之后具有要安装的APAR 列表的可选文件。-l标志必须和该选项一起使用。 -Ffixes 要在rootvg 克隆后安装的APAR 可选列表（例如，&ldquo;IX123456&rdquo;）。-l标志必须和该选项一起使用。 -Iinstallp_flags 当将新文件集更新或安装到已克隆的alt_inst_rootvg 中时要使用的标志。缺省标志：&ldquo;-acgX&rdquo;，-l标志必须和该选项一起使用。 -limages_location 在rootvg 克隆后要应用的installp 映象或更新的位置。这可以是目录完整的路径名或设备名称（如/dev/rmt0）。 -wfilesets 在克隆rootvg 后要安装的文件集列表。-l标志必须和该选项一起使用。 以下标志可用于alt_disk_install版本4.3.2 或更高版本： -qdisk 用于返回卷组引导磁盘名称。从备用磁盘重新启动后，尝试从&ldquo;old_rootvg&rdquo;卷组中的多个磁盘确定引导磁盘时，这特别有用。 -S 将卷组&ldquo;置于睡眠&rdquo;。这在卷组&ldquo;唤醒&rdquo;后使用。（-W）。 -vnew_volume_group_name disk 用于重命名备用磁盘卷组。当在多个卷组中创建多个备用磁盘时特别有用，而且名称标识是必需的。 -Wdisk 用来&ldquo;唤醒&rdquo;卷组以在rootvg 和备用磁盘rootvg 间的数据存取。 注：经历&ldquo;唤醒&rdquo;的卷组将重命名为&ldquo;altinst_rootvg&rdquo;。 限制 正在运行系统的操作系统版本必须高于或等于经历&ldquo;唤醒&rdquo;的卷组的操作系统版本。这可能意味着有必要从&ldquo;altinst_rootvg&rdquo;引导并&ldquo;唤醒&rdquo;&ldquo;old_rootvg&rdquo;。 参数 target_disks 指定备用rootvg 要创建于其上的目标磁盘的一个或多个名称。这个磁盘或这些磁盘当前不得包含任何卷组定义。lspv命令应该将这些磁盘显示为属于卷组None。 